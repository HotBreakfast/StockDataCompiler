Option Explicit
'Allen Mattson
'2/1/2016
'mattson.allen@gmail.com
Dim LR As Long, cell As Range
Public Sub Industries()
Application.ScreenUpdating = True
Application.Cursor = xlWait
Application.DisplayStatusBar = True
Application.StatusBar = "Wait Bro..."
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
Dim company As String, code As String
LR = Sheets("Allen").Cells(Rows.Count, 1).End(xlUp).Row
Dim industryList As Range
Set industryList = Range(Cells(11, 1), Cells(LR, 1))

Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual

For Each cell In industryList
    cell.Offset(0, 1).Copy Sheets("Allen").Range("B1")
    Sheets.Add
    ActiveSheet.Name = cell.Value
    IND_URL_Static_Query (cell.Offset(0, 1).Value)
    FIXB
    LabelSectorsandIndustries
Next

SortWorksheets

Application.EnableEvents = True

showall
ALLCOMPANIES
FixM

'ThisWorkbook.Saved = True

DelUneededSheets
sbDelete_Rows_Based_On_Cell_Color

addnewWorkBook
End Sub
Private Function IND_URL_Static_Query(cell)
Dim code As String
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
On Error Resume Next
code = Sheets("Allen").Range("tag").Value
ActiveSheet.Cells.Clear
   With ActiveSheet.QueryTables.Add(Connection:= _
      "URL;http://biz.yahoo.com/p/csv/" & code & "conameu.csv", _
         Destination:=Range("a1"))
      .BackgroundQuery = True
      .TablesOnlyFromHTML = True
      .Refresh BackgroundQuery:=False
      .SaveData = True
   End With
ActiveSheet.Range("a1").CurrentRegion.TextToColumns Destination:=ActiveSheet.Range("a1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False
ActiveSheet.Columns.AutoFit
End Function
Private Sub delsheets()
Sheets("Allen").Visible = True
 Dim Sh As Worksheet
Application.DisplayAlerts = False
For Each Sh In ActiveWorkbook.Sheets
 If Sh.Name <> "Allen" Then
    Sh.Delete
 End If
Next Sh
Application.DisplayAlerts = True
 End Sub
Private Sub sbDelete_Rows_Based_On_Cell_Color()
Sheets("Companies").Activate
Dim lRow As Long
Dim i As Integer
lRow = Cells(Rows.Count, 1).End(xlUp).Row
For i = lRow To 1 Step -1
    If Cells(i, 1).Interior.ColorIndex = 6 Then Rows(i).EntireRow.Delete
Next i
End Sub

Private Sub SortWorksheets()
     
    Dim N As Integer
    Dim M As Integer
    Dim FirstWSToSort As Integer
    Dim LastWSToSort As Integer
    Dim SortDescending As Boolean
     
    SortDescending = False
     
    If ActiveWindow.SelectedSheets.Count = 1 Then
         
         'Change the 1 to the worksheet you want sorted first
        FirstWSToSort = 1
        LastWSToSort = Worksheets.Count
    Else
        With ActiveWindow.SelectedSheets
            For N = 2 To .Count
                If .Item(N - 1).Index <> .Item(N).Index - 1 Then
                    MsgBox "You cannot sort non-adjacent sheets"
                   ' Exit Private sub
                End If
            Next N
            FirstWSToSort = .Item(1).Index
            LastWSToSort = .Item(.Count).Index
        End With
    End If
     
    For M = FirstWSToSort To LastWSToSort
        For N = M To LastWSToSort
            If SortDescending = True Then
                If UCase(Worksheets(N).Name) > UCase(Worksheets(M).Name) Then
                    Worksheets(N).Move Before:=Worksheets(M)
                End If
            Else
                If UCase(Worksheets(N).Name) < UCase(Worksheets(M).Name) Then
                    Worksheets(N).Move Before:=Worksheets(M)
                End If
            End If
        Next N
    Next M
     
End Sub
Private Sub FIXB()

    LR = Cells(Rows.Count, 10).End(xlUp).Row
    Dim RNG1 As Range
    Set RNG1 = Range("K2:K" & LR)
    Dim cell As Range
    For Each cell In RNG1
        If Not IsEmpty(cell.Value) Then
            cell.Offset(0, -10).Value = cell.Offset(0, -10).Value & cell.Offset(0, -9).Value
            cell.Offset(0, -9).Delete shift:=xlToLeft
        End If
    Next cell

End Sub

Private Sub KeepOtherSheetsHidden()
Application.ScreenUpdating = False
Dim ws As Worksheet
For Each ws In ThisWorkbook.Worksheets
    If ws.Visible = True And ws.Name <> "All_Sectors" Then
        ws.Visible = xlSheetHidden
    End If
Next
Sheets("All_Sectors").Select
Application.ScreenUpdating = False
End Sub
Private Sub showsheet()
Sheets("Allen").Visible = True
Sheets("Allen").Select
End Sub
Private Sub LabelSectorsandIndustries()
Application.EnableEvents = False
ActiveSheet.Select

'add columns to sort by sector and industry
Columns("A:A").Select
Selection.Insert shift:=xlToRight
Selection.Insert shift:=xlToRight
DoEvents
With ActiveSheet

'label headers

Cells(1, 1) = "Sector"
Cells(1, 2) = "Industry"
Cells(1, 3) = "Company"
End With
'loop range to fill in cells for industry and companies
'''-------first find last row
Dim Sector, cell As Range

Dim LR As Long
LR = Cells(Rows.Count, 3).End(xlUp).Row

Set Sector = ActiveSheet.Range(Cells(2, 1), Cells(LR, 1))

For Each cell In Sector
    cell.Value = Cells(2, 3)
    cell.Offset(0, 1).Value = Cells(3, 3)
Next
ActiveSheet.Rows("2:3").Delete shift:=xlUp

Handler:
Application.EnableEvents = True
Columns.AutoFit
End Sub
Private Sub showall()
Application.ScreenUpdating = False
Application.DisplayAlerts = False
On Error GoTo Handler
Sheets("Companies").Delete
Handler:
Dim ws As Worksheet
For Each ws In ThisWorkbook.Worksheets
    ws.Visible = True
Next
Sheets("Allen").Visible = xlSheetHidden

'Sheets("Sector-Financial").Visible = xlSheetHidden
'Sheets("Sector-Services").Visible = xlSheetHidden
'Sheets("Sector-Basic Materials").Visible = xlSheetHidden
'Sheets("Sector-Consumer Goods").Visible = xlSheetHidden
'Sheets("Sector-Technology").Visible = xlSheetHidden
'Sheets("Sector-Services").Visible = xlSheetHidden
'Sheets("All_Sectors").Visible = xlSheetHidden
'Sheets("All_Sectors").Visible = xlSheetHidden

Application.ScreenUpdating = True
Application.DisplayAlerts = True
End Sub
Private Sub ALLCOMPANIES()
Application.ScreenUpdating = False
Application.EnableEvents = False

    Dim j As Integer

    On Error Resume Next

    Worksheets.Add ' add a sheet in first place
    Sheets(1).Name = "Companies"

    ' copy headings
    Sheets(1).Activate
    Range("A1").EntireRow.Select
    Selection.Copy Destination:=Sheets(1).Range("A1")
    
    ' work through sheets
    For j = 3 To Sheets.Count ' from sheet 2 to last sheet
        Sheets(j).Activate ' make the sheet active
        Range("A1").Select
        Selection.CurrentRegion.Select ' select all cells in this sheets

        ' select all lines except title
        Selection.Offset(1, 0).Resize(Selection.Rows.Count).Select

        ' copy cells selected in the new sheet on last line
        Selection.Copy Destination:=Sheets(1).Range("A65536").End(xlUp)(2)
    Next
Application.EnableEvents = True
Application.ScreenUpdating = True
Sheets("Companies").Select
End Sub
Private Sub FixM()
Sheets("Companies").Select
    LR = Cells(Rows.Count, 13).End(xlUp).Row
    Dim RNG1 As Range
    Set RNG1 = Range("M2:M" & LR)
    Dim cell As Range
    For Each cell In RNG1
        If Not IsEmpty(cell.Value) Then
            cell.Offset(0, -10).Value = cell.Offset(0, -10).Value & cell.Offset(0, -9).Value
            cell.Offset(0, -9).Delete shift:=xlToLeft
        End If
    Next cell
End Sub
Private Sub DelUneededSheets()
Application.EnableEvents = False
Dim ws As Worksheet
Sheets("Allen").Visible = xlSheetHidden
Application.DisplayAlerts = False
Application.ScreenUpdating = False
    For Each ws In ThisWorkbook.Worksheets
        If ws.Name <> "Companies" Then
        If ws.Visible = True Then
            ws.Delete
        End If
        End If
    Next
Application.EnableEvents = True
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End Sub
Private Sub addnewWorkBook()
Dim MainWB As Workbook: Set MainWB = ActiveWorkbook
Dim MainWS As Worksheet: Set MainWS = MainWB.Sheets("Companies")
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Application.Cursor = xlWait
Application.DisplayStatusBar = True
Application.StatusBar = "Keep Waiting..."
Dim SectWB As Workbook
    Dim wkb As Workbook
    Dim FileName As String
    Dim File As String
        'Adding New Workbook
   Set wkb = Workbooks.Add
'

Set SectWB = ActiveWorkbook
With SectWB
'create sector sheets
Worksheets.Add(after:=Worksheets(1)).Name = "Basic Materials"
Worksheets.Add(after:=Worksheets(2)).Name = "Conglomerates"
Worksheets.Add(after:=Worksheets(3)).Name = "Consumer Goods"
Worksheets.Add(after:=Worksheets(4)).Name = "Financial"
Worksheets.Add(after:=Worksheets(5)).Name = "Healthcare"
Worksheets.Add(after:=Worksheets(6)).Name = "Industrial Goods"
Worksheets.Add(after:=Worksheets(7)).Name = "Services"
Worksheets.Add(after:=Worksheets(8)).Name = "Technology"
Worksheets.Add(after:=Worksheets(9)).Name = "Utilities"
End With
With SectWB
    GetAllSectors
End With
Sheets("Industries").Select
addHeader
Worksheets.Add(after:=Worksheets(11)).Name = "Companies"
MainWS.Cells.Copy SectWB.Sheets("Companies").Cells
DeleteSheets
SecInfo
Application.StatusBar = "Still working on it..."
GetAllTickSymbols
MainWB.Activate
Application.Cursor = xlDefault
Application.StatusBar = False
Application.ScreenUpdating = True
With MainWB
    CloseBook
End With
End Sub

Private Sub GetAllSectors()

On Error Resume Next

'SecInfo
bm
byme
c
byme
cg
byme
F
byme
h
byme
ig
byme
s
byme
t
byme
Utilities
byme
ALLINDUSTRIES


End Sub

Private Sub byme()

CleanUpIndustries

End Sub


Private Sub bm()
Sheets("Basic Materials").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Basic Materials").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/1conameu.csv", Destination:=Range("A1"))
    .Name = "BasicMaterials"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Basic Materials").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Basic Materials").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub c()
Sheets("Conglomerates").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Conglomerates").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/2conameu.csv", Destination:=Range("A1"))
    .Name = "Conglomerates"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Conglomerates").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Conglomerates").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub cg()
Sheets("Consumer Goods").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Consumer Goods").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/3conameu.csv", Destination:=Range("A1"))
    .Name = "ConsumerGoods"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Consumer Goods").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Consumer Goods").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub F()
Sheets("Financial").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Financial").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/4conameu.csv", Destination:=Range("A1"))
    .Name = "Financial"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Financial").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Financial").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub h()
Sheets("Healthcare").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Healthcare").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/5conameu.csv", Destination:=Range("A1"))
    .Name = "Healthcare"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Healthcare").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Healthcare").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub ig()
Sheets("Industrial Goods").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Industrial Goods").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/6conameu.csv", Destination:=Range("A1"))
    .Name = "IndustrialGoods"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Industrial Goods").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Industrial Goods").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub s()
Sheets("Services").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Services").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/7conameu.csv", Destination:=Range("A1"))
    .Name = "Services"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Services").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Services").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub t()
Sheets("Technology").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Technology").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/8conameu.csv", Destination:=Range("A1"))
    .Name = "Technology"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Technology").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Technology").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub
Private Sub Utilities()
Sheets("Utilities").Select
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Utilities").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
    
    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/9conameu.csv", Destination:=Range("A1"))
    .Name = "Utilities"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With


Sheets("Utilities").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Utilities").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
End Sub


Private Sub ALLINDUSTRIES()


    Dim j As Integer

    On Error Resume Next

    Worksheets.Add ' add a sheet in first place
    Sheets(1).Name = "Industries"

    ' copy headings
    Sheets(1).Activate
    Range("A1").EntireRow.Select
    Selection.Copy Destination:=Sheets(1).Range("A1")

    ' work through sheets
    For j = 1 To Sheets.Count ' from sheet 2 to last sheet
        Sheets(j).Activate ' make the sheet active
        Range("A1").Select
        Selection.CurrentRegion.Select ' select all cells in this sheets

        ' select all lines except title
        Selection.Offset(1, 0).Resize(Selection.Rows.Count).Select

        ' copy cells selected in the new sheet on last line
        Selection.Copy Destination:=Sheets(1).Range("A65536").End(xlUp)(2)
    Next

End Sub
Private Sub SecInfo()
Worksheets.Add.Name = "Sectors"
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
Sheets("Sectors").Cells.Clear
Sheets("Sectors").Select
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual

    
With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://biz.yahoo.com/p/csv/s_conameu.csv", Destination:=ActiveSheet.Range("A1"))
    .Name = "Sectors"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With

ActiveSheet.Range("A1").CurrentRegion.TextToColumns Destination:=Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False

Dim SecSh As Worksheet: Set SecSh = ActiveSheet

RemoveBlankSheets_ActiveWorkbook

ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
Worksheets("Sectors").Move Before:=Worksheets(1)
End Sub
Private Sub RemoveBlankSheets_ActiveWorkbook()
'PURPOSE: Delete any blanks sheets in the active workbook
'SOURCE: www.TheSpreadsheetGuru.com/the-code-vault

Dim SHT As Worksheet

Application.ScreenUpdating = False
Application.DisplayAlerts = False
  
For Each SHT In ActiveWorkbook.Worksheets
  If WorksheetFunction.CountA(SHT.Cells) = 0 And _
    ActiveWorkbook.Sheets.Count > 1 Then SHT.Delete
Next SHT

Application.DisplayAlerts = True
Application.ScreenUpdating = True

End Sub
Private Sub CleanUpIndustries()

' Correct Industry Names
'Delete incorrect cell
Dim RNG As Range
Dim LR As Long: LR = Cells.Find(what:="*", after:=[a1], searchorder:=xlByRows, searchdirection:=xlPrevious).Row
Set RNG = ActiveSheet.Range("A2" & ":A" & LR)
Dim cell As Range
For Each cell In RNG
    If cell.Value = "Recreational Goods" Then
        cell.Value = "Recreational Goods_Other"

    Else
        If cell.Value = "Tobacco Products" Then
        cell.Value = "Tobacco Products_Other"

    Else
        If cell.Value = "Lumber" Then
        cell.Value = "Lumber_Wood Production"

    Else
        If cell.Value = "Air Services" Then
        cell.Value = "Air Services_Other"

    Else
        If cell.Value = "Discount" Then
        cell.Value = "Discount_Variety Stores"

    Else
        If cell.Value = "Movie Production" Then
        cell.Value = "Movie Production_Theaters"

    Else
        If cell.Value = "Specialty Retail" Then
        cell.Value = "Specialty Retail_Other"

    Else
        If cell.Value = "Wholesale" Then
        cell.Value = "Wholesale_Other"
End If
End If
End If
End If
End If
End If
End If
End If
Next


Dim RNG2 As Range

Set RNG2 = ActiveSheet.Range("B2" & ":B" & LR)
For Each cell In RNG2
    If Not IsNumeric(cell) Then
        cell.Delete shift:=xlToLeft
    End If
Next

End Sub

Private Sub addHeader()
ActiveSheet.Rows("1:1").Delete
ActiveSheet.Range("A1").Value = "Industry"
ActiveSheet.Range("B1").Value = "1-Day Price Chg %"
ActiveSheet.Range("C1").Value = "Market Cap"
ActiveSheet.Range("D1").Value = "P/E"
ActiveSheet.Range("E1").Value = "ROE %"
ActiveSheet.Range("F1").Value = "Div. Yield %"
ActiveSheet.Range("G1").Value = "Debt to Equity"
ActiveSheet.Range("H1").Value = "Price to Book"
ActiveSheet.Range("I1").Value = "Net Profit Margin (mrq)"
ActiveSheet.Range("J1").Value = "Price To Free Cash Flow (mrq)"
Columns.AutoFit
End Sub
Private Sub DeleteSheets()
    Dim ws As Worksheet
    
    Application.DisplayAlerts = False   'Optional
    
    For Each ws In Worksheets
        Select Case ws.Name
            'Include sheet names to keep on next line (with comma between)
            Case "Industries", "Companies"  ', "Sheet3"
                'Do nothing
            Case Else
                ws.Delete
        End Select
    Next ws
    Application.DisplayAlerts = True
    
End Sub
Private Sub CloseBook()
    Application.DisplayAlerts = False
    ActiveWorkbook.Close
    Application.DisplayAlerts = True
End Sub

Sub GetAllTickSymbols()
Dim LR As Long
Dim i As Integer
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual

Sheets.Add
ActiveSheet.Name = "Me"
Sheets("Me").Select
Dim k, r As Integer
For r = 1 To 26
On Error GoTo ErrorHandler
Sheets("Me").Select
    For k = 65 To 90
        Sheets("Me").Cells(r, 4).Formula = "=char(" & k & ")"
        Sheets.Add
        ActiveSheet.Name = Sheets("Me").Cells(r, 4).Value
    Next
Next
ErrorHandler:
Sheets("Me").Range("D1").Value = "A"
Sheets("Me").Range("D2").Value = "B"
Sheets("Me").Range("D3").Value = "C"
Sheets("Me").Range("D4").Value = "D"
Sheets("Me").Range("D5").Value = "E"
Sheets("Me").Range("D6").Value = "F"
Sheets("Me").Range("D7").Value = "G"
Sheets("Me").Range("D8").Value = "H"
Sheets("Me").Range("D9").Value = "I"
Sheets("Me").Range("D10").Value = "J"
Sheets("Me").Range("D11").Value = "K"
Sheets("Me").Range("D12").Value = "L"
Sheets("Me").Range("D13").Value = "M"
Sheets("Me").Range("D14").Value = "N"
Sheets("Me").Range("D15").Value = "O"
Sheets("Me").Range("D16").Value = "P"
Sheets("Me").Range("D17").Value = "Q"
Sheets("Me").Range("D18").Value = "R"
Sheets("Me").Range("D19").Value = "S"
Sheets("Me").Range("D20").Value = "T"
Sheets("Me").Range("D21").Value = "U"
Sheets("Me").Range("D22").Value = "V"
Sheets("Me").Range("D23").Value = "W"
Sheets("Me").Range("D24").Value = "X"
Sheets("Me").Range("D25").Value = "Y"
Sheets("Me").Range("D26").Value = "Z"
Sheets.Add
ActiveSheet.Name = "Stocks"
Sheets("Me").Select
Dim list, cell As Range
Set list = Sheets("Me").Range("D1:D26")
For Each cell In list
    Sheets(cell.Value).Cells.Clear
    MyNasdaq (cell)
    DoEvents
Next
MoveStockSymbols
Sheets.Add
ActiveSheet.Name = "Main"
Sheets("Main").Select
LR = Sheets("Main").Cells(Rows.Count, 1).End(xlUp).Row
For i = 1 To LR
    If Cells(i, 1).Offset(0, 2).Value = "" Then
        Sheets("Main").Cells(i, 1).Offset(0, 2).Value = "NASDAQ"
    Else
        Cells(i, 1).Offset(0, 2).Value = Cells(i, 1).Offset(0, 2).Value
    End If
Next
DoEvents

For Each cell In list
    Sheets(cell.Value).Cells.Clear
    MyAmex (cell)
    DoEvents
Next
MoveStockSymbols

Sheets("Main").Select
LR = Sheets("Main").Cells(Rows.Count, 1).End(xlUp).Row
For i = 1 To LR
    If Cells(i, 1).Offset(0, 2).Value = "" Then
        Sheets("Main").Cells(i, 1).Offset(0, 2).Value = "AMEX"
    Else
        Cells(i, 1).Offset(0, 2).Value = Cells(i, 1).Offset(0, 2).Value
    End If
Next
DoEvents
For Each cell In list
    Sheets(cell.Value).Cells.Clear
    MyNYSE (cell)
    DoEvents
Next
MoveStockSymbols

Sheets("Main").Select
LR = Sheets("Main").Cells(Rows.Count, 1).End(xlUp).Row
For i = 1 To LR
    If Cells(i, 1).Offset(0, 2).Value = "" Then
        Sheets("Main").Cells(i, 1).Offset(0, 2).Value = "NYSE"
    Else
        Cells(i, 1).Offset(0, 2).Value = Cells(i, 1).Offset(0, 2).Value
    End If
Next
Sheets("Stocks").Cells.Clear

Sheets("Main").Range("A1").Select
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlAutomatic
Sheets("Main").Range("A1").Value = "Name"
Sheets("Main").Range("B1").Value = "Ticker"
Sheets("Main").Range("C1").Value = "Exchange"

KeepImportantSheetsOnly
End Sub
Private Sub MyNasdaq(cell)

Sheets("Stocks").Cells.Clear
Sheets("Stocks").Select

Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Dim code As String
code = cell

With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://www.advfn.com/nasdaq/nasdaq.asp?companies=" & code, Destination:=Range("A1"))
    .Name = "Stocks"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With
On Error GoTo Handler

Sheets("Stocks").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Stocks").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False
Handler:
MoveMyStocks (cell)
ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic

End Sub
Private Sub MyAmex(cell)

Sheets("Stocks").Cells.Clear
Sheets("Stocks").Select

Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Dim code As String
code = cell

With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://www.advfn.com/amex/americanstockexchange.asp?companies=" & code, Destination:=Range("A1"))
    .Name = "Stocks"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With
On Error GoTo Handler

Sheets("Stocks").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Stocks").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False
Handler:
MoveMyStocks (cell)
ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic

End Sub
Private Sub MyNYSE(cell)

Sheets("Stocks").Cells.Clear
Sheets("Stocks").Select

Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Dim code As String
code = cell

With ActiveSheet.QueryTables.Add _
(Connection:="URL;http://www.advfn.com/nyse/newyorkstockexchange.asp?companies=" & code, Destination:=Range("A1"))
    .Name = "Stocks"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With
On Error GoTo Handler

Sheets("Stocks").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Stocks").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False
Handler:
MoveMyStocks (cell)
ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic

End Sub
Private Sub MoveMyStocks(cell)
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Sheets("Stocks").Rows("1:10").Delete shift:=xlUp
Sheets("Stocks").Columns("A:A").Delete shift:=xlLeft

Dim ws As Worksheet, ws1 As Worksheet
Set ws1 = Sheets("Stocks")
Sheets(cell).Select
Set ws = ActiveSheet
ws.Cells.Clear
ws1.Range(ws1.UsedRange.Address).Copy
ws.Range("a1").PasteSpecial xlPasteValues
ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic

End Sub
Private Sub MoveStockSymbols()

Sheets("Me").Select
Dim RNG As Range: Set RNG = Sheets("Me").Range("D1:D27")
Dim cell As Range
For Each cell In RNG
On Error GoTo ErrorHandler
Sheets(cell.Value).Select
Dim ws As Worksheet: Set ws = ActiveSheet
ws.Range("A1").Activate
Dim Mycell As Range
For Each Mycell In ws.UsedRange.SpecialCells(xlCellTypeConstants)
Mycell = WorksheetFunction.Trim(Mycell)
Next Mycell

    ws.Range(ws.UsedRange.Address).Copy
    Dim LR As Long
    Sheets("Main").Select
    LR = Sheets("Main").Cells(Rows.Count, 1).End(xlUp).Row + 1
    Sheets("Main").Range("A" & LR).PasteSpecial xlPasteValues
    Application.CutCopyMode = False
Next
ErrorHandler:
End Sub
Private Sub KeepImportantSheetsOnly()
Application.DisplayAlerts = False


Dim ws As Worksheet
Dim MyBook As Workbook: Set MyBook = ActiveWorkbook
For Each ws In MyBook.Worksheets
    If ws.Name <> "Companies" And ws.Name <> "Sectors" And ws.Name <> "Industries" And ws.Name <> "Main" And ws.Name <> "ETFs" Then ws.Delete
Next
For Each ws In MyBook.Worksheets
    If ws.Name = "Main" Then ws.Name = "Ticker Symbols"
Next
Sheets("Ticker Symbols").Range("B1").Clear
Sheets("Ticker Symbols").Cells.Copy
Sheets.Add
ActiveSheet.Paste
ActiveSheet.Name = "TickerCopy"
Application.DisplayAlerts = True
Application.ScreenUpdating = True
Application.CutCopyMode = False

Call GetMoneyLikeaBear
End Sub
Private Sub GetMoneyLikeaBear()
Sheets.Add
ActiveSheet.Name = "ETFs"
Sheets("ETFs").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
With ActiveSheet.QueryTables.Add(Connection:="URL;http://www.nasdaq.com/investing/etfs/etf-finder-results.aspx?download=Yes", Destination:=Range("A1"))
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With
ActiveSheet.Range("A1").CurrentRegion.TextToColumns Destination:=ActiveSheet.Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _
Semicolon:=False, Comma:=True, Space:=False, other:=False
Application.CutCopyMode = False
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
DoEvents
Call AllenKnowsBears
End Sub
Private Sub AllenKnowsBears()
Sheets("ETFs").Select
Dim BearTickLR As Long, BearRange As Range
BearTickLR = Sheets("ETFs").Cells(Rows.Count, 2).End(xlUp).Row
Set BearRange = Sheets("ETFs").Range("B1:B" & BearTickLR)
BearRange.Copy
ActiveSheet.Columns("A:A").Insert shift:=xlToRight
BearRange.Cells.Value = "ETF"
Dim BearsEatLastRow As Long: BearsEatLastRow = Sheets("ETFs").Cells(Rows.Count, 3).End(xlUp).Row
Sheets("Ticker Symbols").Select
Dim GoLR As Long: GoLR = Sheets("Ticker Symbols").Cells(Rows.Count, 1).End(xlUp).Row
Dim IneedThisTowork As Range: Set IneedThisTowork = Sheets("Ticker Symbols").Range("A" & GoLR + 1)
Sheets("ETFs").Range("A2:C" & BearsEatLastRow).Copy IneedThisTowork

Sheets("TickerCopy").Cells.Clear
Sheets("Ticker Symbols").Cells.Copy
Sheets("TickerCopy").Cells.PasteSpecial xlPasteValues

Application.CutCopyMode = False
MovingSymbols
End Sub
Private Sub MovingSymbols()
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Dim ws As Worksheet: Set ws = Sheets("Ticker Symbols")
ws.Select

ws.Columns("F:F").Delete shift:=xlToLeft
With ws

Dim LR As Long
LR = ws.Cells(Rows.Count, 2).End(xlUp).Row
Sheets("TickerCopy").Select
Sheets("TickerCopy").Cells(1, 6).Insert shift:=xlDown
ws.Select
ws.Range("F1:F60").Copy
Sheets("TickerCopy").Range("F1").PasteSpecial xlPasteValues
Application.CutCopyMode = False
ws.Columns("F:F").Delete shift:=xlToLeft

Dim i As Long, j As Long, k As Long
For i = 1 To LR Step 2
    For j = 2 To LR Step 2
        For k = 1 To 100
            If Cells(2, 2).Value <> "" Then
            Cells(k, 6).Value = " " & Cells(k, 6).Value & " " & Cells(i + j, 2).Value & " " & Cells(i, 2).Value & " " & Cells(j, 2).Value & " "
            Cells(i, 2).Delete shift:=xlUp
            Cells(j, 2).Delete shift:=xlUp
            ElseIf Cells(2, 2).Value = "" Then GoTo Handler
            End If
        Next
    Next
Next
Handler:

Sheets("TickerCopy").Cells(1, 6).Insert shift:=xlDown
ws.Range("F1:F900").Copy Sheets("TickerCopy").Range("F1")
Application.CutCopyMode = False
ws.Columns("F:F").Delete shift:=xlToLeft
End With
Sheets("TickerCopy").Range("B1:B6015").Copy ws.Range("B1")
Application.CutCopyMode = False
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlAutomatic
GotListLetsDoMath
End Sub

Private Sub GotListLetsDoMath()
Sheets.Add
ActiveSheet.Name = "Data"
Sheets.Add
ActiveSheet.Name = "Final"
Dim list As Range
Dim SHT As Worksheet: Set SHT = Sheets("TickerCopy")
SHT.Select
Dim LastRow As Long
LastRow = SHT.Cells(Rows.Count, 6).End(xlUp).Row
Set list = SHT.Range(Cells(1, 6), Cells(LastRow, 6))
For Each cell In list
    Call Math(cell)
Next
Attribs
End Sub

Private Sub Math(cell)
Sheets("Data").Cells.Clear
'create a web query in the current worksheet
'connect to the web, retrieve data, and paste it in the worksheet as static text
'Sheets("Attributes").Cells.Clear
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Dim Symbol As String
Dim Attribs As String
Symbol = cell
Attribs = "snxp2l1m4m3kjwva2t8ohgmc1pcm5m6m7m8k4k5j5j6b4rr5s7p6p5ydr1qej4j1f6aa5bb6ld1k3t1e9e7r6e8r7c8g3b2b3c6k2c3m2w1w4l2g4g6g1g5v1v7k1l3j3in4i5r2p1s1t7d2t6"

With Sheets("Data").QueryTables.Add _
(Connection:="URL;http://download.finance.yahoo.com/d/quotes.csv?s=" & Symbol & "&f=" & Attribs & "&e=.csv", Destination:=Sheets("Data").Range("A1"))
    .Name = "Attributes"
    .BackgroundQuery = True
    .TablesOnlyFromHTML = False
    .Refresh BackgroundQuery:=False
    .SaveData = True
End With

With Sheets("Data")
Sheets("Data").Range("A1").CurrentRegion.TextToColumns Destination:=Sheets("Data").Range("A1"), DataType:=xlDelimited, _
TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, Semicolon:=False, Comma:=True, Space:=False, other:=False
End With
PasteTheAtts (cell)
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlCalculationAutomatic
ActiveSheet.Columns.AutoFit

End Sub
Private Sub Attribs()
Sheets("Final").Select

ActiveSheet.Range("A1").Value = "Symbol"
ActiveSheet.Range("B1").Value = "Name"
ActiveSheet.Range("C1").Value = "Stock Exchange"
ActiveSheet.Range("D1").Value = "Change in Percent"
ActiveSheet.Range("E1").Value = "Last Trade (Price Only)"
ActiveSheet.Range("F1").Value = "200-day Moving Average"
ActiveSheet.Range("G1").Value = "50-day Moving Average"
ActiveSheet.Range("H1").Value = "52-week High"
ActiveSheet.Range("I1").Value = "52-week Low"
ActiveSheet.Range("J1").Value = "52-week Range"
ActiveSheet.Range("K1").Value = "Volume"
ActiveSheet.Range("L1").Value = "Average Daily Volume"
ActiveSheet.Range("M1").Value = "1 yr Target Price"
ActiveSheet.Range("N1").Value = "Open"
ActiveSheet.Range("O1").Value = "Day's High"
ActiveSheet.Range("P1").Value = "Day's Low"
ActiveSheet.Range("Q1").Value = "Day's Range"
ActiveSheet.Range("R1").Value = "Change"
ActiveSheet.Range("S1").Value = "Previous Close"
ActiveSheet.Range("T1").Value = "Change & Percent Change"
ActiveSheet.Range("U1").Value = "Change From 200-day Moving Average"
ActiveSheet.Range("V1").Value = "Percent Change From 200-day Moving Average"
ActiveSheet.Range("W1").Value = "Change From 50-day Moving Average"
ActiveSheet.Range("X1").Value = "Percent Change From 50-day Moving Average"
ActiveSheet.Range("Y1").Value = "Change From 52-week High"
ActiveSheet.Range("Z1").Value = "Percent Change From 52-week High"
ActiveSheet.Range("AA1").Value = "Change From 52-week Low"
ActiveSheet.Range("AB1").Value = "Percent Change From 52-week Low"
ActiveSheet.Range("AC1").Value = "Book Value"
ActiveSheet.Range("AD1").Value = "P/E Ratio"
ActiveSheet.Range("AE1").Value = "PEG Ratio"
ActiveSheet.Range("AF1").Value = "Short Ratio"
ActiveSheet.Range("AG1").Value = "Price/Book"
ActiveSheet.Range("AH1").Value = "Price/Sales"
ActiveSheet.Range("AI1").Value = "Dividend Yield"
ActiveSheet.Range("AJ1").Value = "Dividend/Share"
ActiveSheet.Range("AK1").Value = "Dividend Pay Date"
ActiveSheet.Range("AL1").Value = "Ex-Dividend Date"
ActiveSheet.Range("AM1").Value = "Earnings/Share"
ActiveSheet.Range("AN1").Value = "EBITDA"
ActiveSheet.Range("AO1").Value = "Market Capitalization"
ActiveSheet.Range("AP1").Value = "Float Shares"
ActiveSheet.Range("AQ1").Value = "Ask"
ActiveSheet.Range("AR1").Value = "Ask Size"
ActiveSheet.Range("AS1").Value = "Bid"
ActiveSheet.Range("AT1").Value = "Bid Size"
ActiveSheet.Range("AU1").Value = "Last Trade (With Time)"
ActiveSheet.Range("AV1").Value = "Last Trade Date"
ActiveSheet.Range("AW1").Value = "Last Trade Size"
ActiveSheet.Range("AX1").Value = "Last Trade Time"
ActiveSheet.Range("AY1").Value = "EPS Estimate Next Quarter"
ActiveSheet.Range("AZ1").Value = "EPS Estimate Current Year"
ActiveSheet.Range("BA1").Value = "Price/EPS Estimate Current Year"
ActiveSheet.Range("BB1").Value = "EPS Estimate Next Year"
ActiveSheet.Range("BC1").Value = "Price/EPS Estimate Next Year"
ActiveSheet.Range("BD1").Value = "After Hours Change (Real-time)"
ActiveSheet.Range("BE1").Value = "Annualized Gain"
ActiveSheet.Range("BF1").Value = "Ask (Real-time)"
ActiveSheet.Range("BG1").Value = "Bid (Real-time)"
ActiveSheet.Range("BH1").Value = "Change (Real-time)"
ActiveSheet.Range("BI1").Value = "Change Percent (Real-time)"
ActiveSheet.Range("BJ1").Value = "Commission"
'Sheets("Data").Rows("2:2").Delete shift:=xlUp
SlickFormulas
End Sub
Private Sub SlickFormulas()
Dim cell, RNG As Range
Dim LR, LastR As Long
Sheets("Ticker Symbols").Select
LastR = Sheets("Ticker Symbols").Cells(Rows.Count, 1).End(xlUp).Row
Sheets("Ticker Symbols").Columns("A:A").Copy
Sheets("Ticker Symbols").Columns("C:C").Insert shift:=xlToRight
Sheets("Final").Select
Columns("C:C").Insert shift:=xlRight

LR = Sheets("Final").Cells(Rows.Count, 2).End(xlUp).Row
Set RNG = Range(Cells(2, 2), Cells(LR, 2))
For Each cell In RNG
    If cell.Value = "N/A" Then
        cell.Offset(0, 1).FormulaR1C1 = "=IF(RC[-1]=""N/A"",VLOOKUP(RC[-2],'Ticker Symbols'!R1C[-1]:R6014C,2,FALSE),RC[-1])"
    ElseIf cell.Value <> "N/A" Then cell.Offset(0, 1).Value = cell.Value
    End If
Next
RNG.Offset(0, 1).Select
Selection.Copy
Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
Columns("B:B").Delete shift:=xlLeft
Range("B1").Value = "Name"
Sheets("Ticker Symbols").Columns("C:C").Delete shift:=xlToLeft
SlickAndSlide
End Sub
Private Sub SlickAndSlide()
Dim cell, RNG2 As Range
Dim lRow As Long
Sheets("Ticker Symbols").Columns("b:b").Insert shift:=xlToRight
Sheets("Final").Select
Columns("D:D").Insert shift:=xlRight

lRow = Sheets("Final").Cells(Rows.Count, 3).End(xlUp).Row
Set RNG2 = Range(Cells(2, 3), Cells(lRow, 3))
For Each cell In RNG2
    If cell.Value = "N/A" Then
        cell.Offset(0, 1).FormulaR1C1 = "=IF(RC[-1]=""N/A"",VLOOKUP(RC[-3],'Ticker Symbols'!R1C[-1]:R6014C,2,FALSE),RC[-1])"
    ElseIf cell.Value <> "N/A" Then cell.Offset(0, 1).Value = cell.Value
    End If
Next
RNG2.Offset(0, 1).Select
Selection.Copy
Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
Columns("C:C").Delete shift:=xlLeft
Range("C1").Value = "Exchange"
Sheets("Ticker Symbols").Columns("b:b").Delete shift:=xlToLeft
LastDealForWorkbookCleanin
End Sub
Private Sub PasteTheAtts(cell)
Dim ws As Worksheet, ws1 As Worksheet
Set ws = Sheets("Final")
Dim LR As Long
LR = ws.Cells(Rows.Count, 1).End(xlUp).Row
Set ws1 = Sheets("Data")
ws1.Select
ws1.Range(ws1.UsedRange.Address).Copy
ws.Range("A" & LR).Offset(1, 0).PasteSpecial xlPasteValues
Application.CutCopyMode = False
ws.Select
End Sub
Private Sub LastDealForWorkbookCleanin()
Sheets("Final").Select
FormattedColumns
Range("A1").Select
Application.DisplayAlerts = False
Dim ws As Worksheet
Dim MyBook As Workbook: Set MyBook = ActiveWorkbook
For Each ws In MyBook.Worksheets
    If ws.Name <> "Companies" And ws.Name <> "Sectors" And ws.Name <> "Industries" And ws.Name <> "Final" And ws.Name <> "Ticker Symbols" And ws.Name <> "ETFs" Then ws.Delete
Next
For Each ws In MyBook.Worksheets
    If ws.Name = "Final" Then ws.Name = "Stock Tickers and Data"
Next

Sheets("Ticker Symbols").Range("E1").Formula = "This workbook was saved on " & Now
Sheets("Ticker Symbols").Range("E2").Formula = "=today()"
Dim MYDATE As String
MYDATE = Sheets("Ticker Symbols").Range("E2").Value

MyBook.SaveAs FileName:="Macintosh HD:Users:allenmattson:HotBreakfastRepo:MarketData:MarketData" & MYDATE & ".xls"
Application.DisplayAlerts = True

End Sub
Private Sub FormattedColumns()
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
With ActiveSheet
Dim LR, LC, i As Long
LR = ActiveSheet.Cells(Rows.Count, 1).End(xlUp).Row
LC = ActiveSheet.Cells(1, Columns.Count).End(xlToLeft).Column
Dim RNG, cell As Range
Set RNG = ActiveSheet.Range(Cells(2, 1), Cells(LR, 1))
RNG.Offset(0, 3).Select
With Selection
    .NumberFormat = "0.00%"
    .Value = .Value
End With
For i = 3 To 8
    RNG.Offset(0, i + 1).Style = "currency"
Next
For Each cell In RNG.Offset(0, 9)
    If cell.Value = "N/A" Then
    cell.Value = cell.Value
    ElseIf cell.Value <> "N/A" Then
    cell.Formula = "=abs(" & cell.Value & ")"
    End If
Next cell
Range("J1").Value = "52 Week Change"
For Each cell In RNG.Offset(0, 16)
    If cell.Value = "N/A" Then
    cell.Value = cell.Value
    ElseIf cell.Value <> "N/A" Then
    cell.Formula = "=abs(" & cell.Value & ")"
    End If
Next cell
Range("Q1").Value = "Day's High to Low Change"
For i = 11 To 19
    RNG.Offset(0, i + 1).Style = "Currency"
Next

RNG.Offset(0, 21).Style = "Percent"
RNG.Offset(0, 22).Style = "Currency"
RNG.Offset(0, 23).Style = "Percent"
RNG.Offset(0, 24).Style = "Currency"
RNG.Offset(0, 25).Style = "Percent"
RNG.Offset(0, 26).Style = "Currency"
RNG.Offset(0, 27).Style = "Percent"
For i = 27 To 34
 RNG.Offset(0, i + 1).Style = "Currency"
Next
RNG.Offset(0, 36).Select
With Selection
    .NumberFormat = "MM/DD/YYYY"
    .Value = .Value
End With
RNG.Offset(0, 37).Select
With Selection
    .NumberFormat = "MM/DD/YYYY"
    .Value = .Value
End With
RNG.Offset(0, 47).Select
With Selection
    .NumberFormat = "MM/DD/YYYY"
    .Value = .Value
End With
RNG.Offset(0, 38).Style = "Currency"
RNG.Offset(0, 39).Style = "Currency"
RNG.Offset(0, 40).Style = "Currency"
RNG.Offset(0, 42).Style = "Currency"
RNG.Offset(0, 44).Style = "Currency"
For i = 49 To 53
    RNG.Offset(0, i + 1).Style = "Currency"
Next
Columns("BD:CF").Delete shift:=xlToLeft
End With
ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlAutomatic
With ActiveSheet
    ChangeColorFontChangePercent
    LastTrade
End With
End Sub

Private Sub ChangeColorFontChangePercent()
Application.ScreenUpdating = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationManual
Dim lRow As Integer
Dim Change As Range, cell As Range
lRow = Range("D" & Rows.Count).End(xlUp).Row
Set Change = Range("D2:D" & lRow)
Change.FormatConditions.Delete
For Each cell In Change
    'cell.FormatConditions.Delete
    cell.Font.Bold = True
    If cell.Value > 0 Then cell.Font.ColorIndex = 10
    If cell.Value < 0 Then cell.Font.ColorIndex = 3
    If cell.Value = "N/A" Then cell.Font.Color = RGB(0, 0, 0)
Next
ActiveSheet.Columns.AutoFit
Application.ScreenUpdating = True
Application.DisplayAlerts = True
Application.Calculation = xlAutomatic
End Sub
Private Sub LastTrade()
Dim LTcell As Range
Dim LR As Integer: LR = ActiveSheet.Cells.Find("*", searchorder:=xlByRows, searchdirection:=xlPrevious).Row
Dim LastTrade As Range: Set LastTrade = ActiveSheet.Range("E2:E" & LR)
LastTrade.FormatConditions.Delete
For Each LTcell In LastTrade
   If LTcell.Value > LTcell.Offset(0, 1).Value And LTcell.Value > LTcell.Offset(0, 2).Value Then LTcell.Interior.ColorIndex = 43
   If LTcell.Value < LTcell.Offset(0, 1).Value And LTcell.Value < LTcell.Offset(0, 2).Value Then LTcell.Interior.ColorIndex = 53
   If LTcell.Value > LTcell.Offset(0, 8).Value Then LTcell.Offset(0, 8).Interior.ColorIndex = 27 And LTcell.Offset(0, 8).Font.ColorIndex = 4
 Next
 LastTrade.Style = "Currency"

End Sub
